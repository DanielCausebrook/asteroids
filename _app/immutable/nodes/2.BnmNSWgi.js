import"../chunks/DsnmJJEf.js";import{d as F,o as T}from"../chunks/C2hLB0R9.js";import{A as M,D as I,J as U,a6 as v,a0 as _,as as E,aB as L,ac as q,a1 as N,$ as Y,G,aa as A,ab as S}from"../chunks/BmeX_oOh.js";import{b as C}from"../chunks/BIYonOwp.js";const b=[...` 	
\r\fÂ \v\uFEFF`];function O(h,i,t){var n=h==null?"":""+h;if(t){for(var e in t)if(t[e])n=n?n+" "+e:e;else if(n.length)for(var o=e.length,l=0;(l=n.indexOf(e,l))>=0;){var r=l+o;(l===0||b.includes(n[l-1]))&&(r===n.length||b.includes(n[r]))?n=(l===0?"":n.substring(0,l))+n.substring(r+1):l=r}}return n===""?null:n}function z(h,i,t,n,e,o){var l=h.__className;if(M||l!==t||l===void 0){var r=O(t,n,o);(!M||r!==h.getAttribute("class"))&&(r==null?h.removeAttribute("class"):h.className=r),h.__className=t}else if(o&&e!==o)for(var f in o){var c=!!o[f];(e==null||c!==!!e[f])&&h.classList.toggle(f,c)}return o}class s{x;y;constructor(i,t){this.x=i,this.y=t}static from(i,t){return new s(i,t)}static fromPolar(i,t){return new s(i*Math.cos(t),i*Math.sin(t))}static add(...i){return new s(i.reduce((t,n)=>t+n.x,0),i.reduce((t,n)=>t+n.y,0))}theta(){return Math.atan2(this.y,this.x)}r(){return Math.hypot(this.x,this.y)}negate(){return new s(-this.x,-this.y)}scale(i){return new s(this.x*i,this.y*i)}}const X={STYLISED:[[[0,0,0],[0,1,1],[1,0,1],[1,0,1],[1,1,0]],[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[0,1,1]],[[0,1,0],[0,0,1],[0,1,0],[1,0,0],[1,1,1]],[[1,1,0],[0,1,0],[0,1,1],[0,0,1],[1,1,0]],[[1,0,0],[1,0,0],[1,0,0],[1,1,1],[0,0,1]],[[1,1,0],[1,0,0],[1,1,1],[0,0,1],[1,1,0]],[[0,1,0],[1,0,0],[1,1,1],[1,0,1],[0,1,0]],[[1,1,1],[0,0,1],[0,1,0],[1,0,0],[1,0,0]],[[0,1,0],[1,0,1],[0,1,0],[1,0,1],[1,1,0]],[[0,1,0],[1,0,1],[1,1,1],[0,0,1],[0,1,1]]]},$={DEFAULT:[[[0,0,0,0],[0,1,1,1],[1,0,0,1],[1,0,1,1],[0,1,0,1]],[[1,0,0,0],[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,1,1,0]],[[0,0,0,0],[0,1,1,1],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[[0,0,0,1],[0,1,1,1],[1,0,0,1],[1,0,0,1],[0,1,1,1]],[[0,0,0,0],[0,1,1,0],[1,1,1,1],[1,0,0,0],[0,1,1,1]],[],[],[],[[1,0,0,0],[0,0,0,0],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[],[],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[[0,0,0,0],[1,1,1,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],[[0,0,0,0],[1,0,1,1],[1,1,0,1],[1,0,0,1],[1,0,0,1]],[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[0,1,1,0]],[],[],[[0,0,0,0],[1,0,1,1],[1,1,0,1],[1,0,0,0],[1,0,0,0]],[],[],[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,0,1,1],[0,1,0,1]],[],[],[],[],[]]};class k{position;constructor(i){this.position=i}}class x{canvas;ctx;originRawPixels;size;pixelScale;mousePos_=null;lastMousePos_=null;registeredMouseClickListeners=new Set;registeredMouseDownListeners=new Set;mouseClickListener=i=>{this.registeredMouseClickListeners.forEach(t=>t(new k(this.fromClientPos(s.from(i.clientX,i.clientY)))))};mouseDownListener=i=>{this.registeredMouseDownListeners.forEach(t=>t(new k(this.fromClientPos(s.from(i.clientX,i.clientY)))))};updateMousePosListener=i=>{this.mousePos_=this.lastMousePos_=this.fromClientPos(s.from(i.clientX,i.clientY))};clearMousePosListener=i=>this.mousePos_=null;constructor(i,t,n,e){this.canvas=i;const o=this.canvas.getContext("2d");if(o===null)throw new Error("Could not get 2D canvas context");this.ctx=o,this.canvas.addEventListener("click",this.mouseClickListener),this.canvas.addEventListener("mousedown",this.mouseDownListener),this.canvas.addEventListener("mouseenter",this.updateMousePosListener),this.canvas.addEventListener("mouseleave",this.clearMousePosListener),this.canvas.addEventListener("mousemove",this.updateMousePosListener),this.originRawPixels=t,this.size=n,this.pixelScale=e}destroy(){this.canvas.removeEventListener("click",this.mouseClickListener),this.canvas.removeEventListener("mousedown",this.mouseDownListener),this.canvas.removeEventListener("mouseenter",this.updateMousePosListener),this.canvas.removeEventListener("mouseleave",this.clearMousePosListener),this.canvas.removeEventListener("mousemove",this.updateMousePosListener),this.registeredMouseClickListeners.clear(),this.registeredMouseDownListeners.clear()}fromClientPos(i){let t=this.canvas.getBoundingClientRect();return s.add(s.add(s.from(i.x,i.y),this.originRawPixels.negate(),s.from(-t.x,-t.y)).scale(1/this.pixelScale),s.from(-.5,-.5))}clear(i){this.ctx.fillStyle=i,this.ctx.fillRect(this.originRawPixels.x,this.originRawPixels.y,this.size.x*this.pixelScale,this.size.y*this.pixelScale)}drawPixel(i,t){this.ctx.fillStyle=t,!(i.x<0||i.x>=this.size.x||i.y<0||i.y>=this.size.y)&&this.ctx.fillRect(this.originRawPixels.x+Math.floor(i.x)*this.pixelScale,this.originRawPixels.y+Math.floor(i.y)*this.pixelScale,this.pixelScale,this.pixelScale)}drawLineLow(i,t,n,e,o){let l=n-i,r=e-t,f=1;r<0&&(r=-r,f=-1);let c=2*r-l,a=t;for(let u=i;u<=n;u++)this.drawPixel(s.from(u,a),o),c>0?(a+=f,c+=2*(r-l)):c+=2*r}drawLineHigh(i,t,n,e,o){let l=n-i,r=e-t,f=1;l<0&&(l=-l,f=-1);let c=2*l-r,a=i;for(let u=t;u<=e;u++)this.drawPixel(s.from(a,u),o),c>0?(a+=f,c+=2*(l-r)):c+=2*l}drawLine(i,t,n){Math.abs(t.y-i.y)<Math.abs(t.x-i.x)?i.x>t.x?this.drawLineLow(t.x,t.y,i.x,i.y,n):this.drawLineLow(i.x,i.y,t.x,t.y,n):i.y>t.y?this.drawLineHigh(t.x,t.y,i.x,i.y,n):this.drawLineHigh(i.x,i.y,t.x,t.y,n)}fillRect(i,t,n){this.ctx.fillStyle=n;const e=s.add(i.scale(this.pixelScale),this.originRawPixels),o=t.scale(this.pixelScale);this.ctx.fillRect(e.x,e.y,o.x,o.y)}fillCircle(i,t,n){let e=Math.floor(i.x-t),o=Math.ceil(i.x+t),l=Math.floor(i.y-t),r=Math.ceil(i.y+t);for(let f=e;f<=o;f+=1)for(let c=l;c<=r;c+=1){let a=new s(f,c);s.add(i,a.negate()).r()<=t&&this.drawPixel(a,n)}}drawBitmap(i,t,n){t.forEach((e,o)=>{e.forEach((l,r)=>{l===1&&this.drawPixel(s.add(i,s.from(r,o)),n)})})}drawNumber(i,t,n){let e=X.STYLISED,o=t.charCodeAt(0)-48;this.drawBitmap(i,e[o],n)}drawChar(i,t,n){let e=$.DEFAULT,o=t.charCodeAt(0)-97;this.drawBitmap(i,e[o],n)}mousePos(){return this.mousePos_}lastMousePos(){return this.lastMousePos_}addClickListener(i){this.registeredMouseClickListeners.add(i)}removeClickListener(i){this.registeredMouseClickListeners.delete(i)}addMouseDownListener(i){this.registeredMouseDownListeners.add(i)}removeMouseDownListener(i){this.registeredMouseDownListeners.delete(i)}subCanvas(i,t){return new x(this.canvas,s.add(this.originRawPixels,i.scale(this.pixelScale)),t,this.pixelScale)}}class W{config;position;velocity=new s(0,0);invulnerabilityUntil=0;lastBlink=null;constructor(i,t){this.config=i,this.position=t}invulnerable(i){return this.invulnerabilityUntil>i||this.inBlinkAnimation(i)}blinkOnCooldown(i){return this.lastBlink!==null&&this.lastBlink.t>i-this.config.blink.cooldown}inBlinkAnimation(i){return this.lastBlink!==null&&this.lastBlink.t>i-this.config.blink.animationDuration}}function H(h){return new s(Math.round(h.x),Math.round(h.y))}class J{size;renderOffset;position;velocity;constructor(i,t,n){this.size=i,this.position=t,this.renderOffset=s.add(this.position,H(this.position).negate()),this.velocity=n}renderPosition(){return s.add(H(this.position),this.renderOffset)}}function V(h){return new Promise(i=>setTimeout(i,h))}class Z{canvas;config;pixelCanvas;instance=null;constructor(i,t){this.canvas=i;let n=D.computeCanvasSize(t);const e=n.scale(t.pixelScale);i.width=e.x,i.height=e.y,this.config=t,this.pixelCanvas=new x(this.canvas,new s(0,0),n,this.config.pixelScale)}destroy(){this.instance!==null&&(this.instance.destroy(),this.instance=null),this.pixelCanvas.destroy()}run(){this.instance===null&&(this.instance=new D(this.pixelCanvas,this.config),this.instance.run())}}const B=9;class D{config;canvas;playAreaCanvas;player;score=0;asteroids=[];nextAsteroidIn=0;playerHitAt=null;playerSpawnAt=0;running=!1;constructor(i,t){this.config=t,this.canvas=i,this.playAreaCanvas=i.subCanvas(new s(1,1),t.playAreaSize),this.player=new W(t,t.playAreaSize.scale(.5))}static computeCanvasSize(i){return s.from(i.playAreaSize.x+2,i.playAreaSize.y+2+B)}destroy(){this.running=!1,this.playAreaCanvas.destroy(),this.canvas.destroy()}async run(){this.running=!0;let i=null;const t=o=>{i=o.position};this.playAreaCanvas.addMouseDownListener(t);let n=new Date().getTime(),e=0;for(;this.running;){const o=(new Date().getTime()-n)/1e3,l=o-e;e=o,this.gameLoop(o,l,i),i=null,await V(1e3/this.config.fps)}this.playAreaCanvas.removeMouseDownListener(t)}gameLoop(i,t,n){let e=this.player,o=this.config.playAreaSize,l=this.config.colors.fg,r=this.config.colors.bg;if(this.playerHitAt===null)if(n!==null&&!e.blinkOnCooldown(i))e.lastBlink={t:i,startPos:e.position,endPos:n,angle:s.add(n,e.position.negate()).theta()},e.position=n,e.velocity=s.fromPolar(this.config.blink.velocity,e.lastBlink.angle);else{let a=0;if(e.lastBlink!==null&&e.lastBlink.t>i-this.config.blink.transitionTime){a=(i-e.lastBlink.t)/this.config.blink.transitionTime;let p=s.fromPolar(this.config.blink.temporaryVelocity/a,e.lastBlink.angle);e.position=s.add(e.position,p.scale(t))}let u=this.playAreaCanvas.lastMousePos();if(u!==null){let p=s.add(u,e.position.negate());e.velocity=s.add(e.velocity,p.scale(this.config.mousePull).scale(t).scale(1-a))}e.position=s.add(e.position,e.velocity.scale(t)),e.position.x<0?(e.position=new s(0,e.position.y),e.velocity.x<0&&(e.velocity=new s(e.velocity.x*-.5,e.velocity.y))):e.position.x>=o.x&&(e.position=new s(o.x,e.position.y),e.velocity.x>0&&(e.velocity=new s(e.velocity.x*-.5,e.velocity.y))),e.position.y<0?(e.position=new s(e.position.x,0),e.velocity.y<0&&(e.velocity=new s(e.velocity.x,e.velocity.y*-.5))):e.position.y>=o.y&&(e.position=new s(e.position.x,o.y),e.velocity.y>0&&(e.velocity=new s(e.velocity.x,e.velocity.y*-.5)))}else this.playerHitAt+this.config.playerHit.respawnTime<i&&(e.position=this.playAreaCanvas.lastMousePos()??this.playAreaCanvas.size.scale(.5),e.velocity=s.from(0,0),this.playerHitAt=null,this.playerSpawnAt=i,this.asteroids=[]);for(this.nextAsteroidIn-=t;this.nextAsteroidIn<=0;){const a=Math.random()*Math.PI*2,u=s.add(s.fromPolar(Math.max(o.x,o.y),a),o.scale(.5)),p=s.fromPolar(this.config.asteroid.velMin+Math.random()*(this.config.asteroid.velMax-this.config.asteroid.velMin),a+.75*Math.PI+.5*Math.PI*Math.random());this.asteroids.push(new J(this.config.asteroid.sizeMin+Math.random()*(this.config.asteroid.sizeMax-this.config.asteroid.sizeMin),u,p)),this.nextAsteroidIn+=this.config.asteroid.spawnFreq}for(const a of this.asteroids)a.position=s.add(a.position,a.velocity.scale(t));if(this.asteroids=this.asteroids.filter(a=>a.position.x<-a.size&&a.velocity.x<0||a.position.x>=o.x+a.size&&a.velocity.x>0||a.position.y<-a.size&&a.velocity.y<0?!1:!(a.position.y>=o.y+a.size&&a.velocity.y>0)),!e.invulnerable(i))for(const a of this.asteroids){if(!(e.position.x>a.position.x-.5*a.size&&e.position.x<a.position.x+.5*a.size&&e.position.y>a.position.y-.5*a.size&&e.position.y<a.position.y+.5*a.size))continue;s.add(e.position,a.position.negate()).r()<.5*a.size&&(this.playerHitAt=i,e.invulnerabilityUntil=i+this.config.playerHit.respawnTime+this.config.playerHit.invulnerabilityDuration)}this.playerHitAt!==null?this.score=this.playerHitAt-this.playerSpawnAt:this.score=i-this.playerSpawnAt;const f=()=>{if(e.inBlinkAnimation(i))return!0;if(this.playerHitAt!==null){const a=i-this.playerHitAt;if(a<this.config.playerHit.flashDuration&&a%this.config.playerHit.flashFreq<.5*this.config.playerHit.flashFreq)return!0}return!1};this.playAreaCanvas.clear(f()?l:r);for(const a of this.asteroids)this.playAreaCanvas.fillCircle(a.renderPosition(),a.size/2,l);if(!!!(this.playerHitAt!==null||e.invulnerable(i)&&(e.invulnerabilityUntil-i)%this.config.playerHit.invulnerabilityFlashFreq<.5*this.config.playerHit.invulnerabilityFlashFreq)){const a=s.from(e.position.x==this.config.playAreaSize.x?this.config.playAreaSize.x-1:e.position.x,e.position.y==this.config.playAreaSize.y?this.config.playAreaSize.y-1:e.position.y);this.playAreaCanvas.drawPixel(a,e.inBlinkAnimation(i)?r:l)}e.lastBlink!==null&&e.inBlinkAnimation(i)&&this.playAreaCanvas.drawLine(e.lastBlink.startPos,e.lastBlink.endPos,r),this.paintHUD()}paintHUD(){let i=this.config.colors.fg,t=this.config.colors.bg,n=this.config.playAreaSize.y+1,e=this.config.playAreaSize.x+1;this.canvas.drawLine(s.from(0,0),s.from(0,n),i),this.canvas.drawLine(s.from(0,n),s.from(e,n),i),this.canvas.drawLine(s.from(0,0),s.from(e,0),i),this.canvas.drawLine(s.from(e,0),s.from(e,n),i);let o=s.from(0,n+1),l=s.from(e,B);const r=i,f=t;this.canvas.fillRect(o,l,f);const c=7,a=s.add(o,s.from(l.x-4*c-3,2)),u=Math.round(this.score*10).toString().padStart(c-1,"0");let p=!0;for(let y=0;y<c-1;y++)p&&y<c-3&&u.charAt(y)==="0"||(p=!1,y===c-2?(this.canvas.drawPixel(s.add(a,s.from(4*y,4)),r),this.canvas.drawNumber(s.add(a,s.from(4*y+2,0)),u.charAt(y),r)):this.canvas.drawNumber(s.add(a,s.from(4*y,0)),u.charAt(y),r))}}const j=[[[1,1,0,0,1],[0,0,0,0,1],[0,0,0,0,0],[1,0,0,0,0],[1,0,0,1,1]],[[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0]]];var K=(h,i)=>E(i,!v(i)),Q=_('<main><div class="wrapper svelte-be2ncb"><canvas></canvas> <canvas></canvas></div></main>');function ni(h,i){I(i,!0);let t,n,e,o={fps:30,playAreaSize:new s(100,100),pixelScale:6,mousePull:6,asteroid:{spawnFreq:.3,sizeMin:8,sizeMax:25,velMin:5,velMax:20},playerHit:{flashFreq:.1,flashDuration:.5,respawnTime:2,invulnerabilityDuration:2,invulnerabilityFlashFreq:.2},blink:{animationDuration:.1,cooldown:1,temporaryVelocity:15,velocity:15,transitionTime:.3},colors:{bg:"#000",fg:"#fff"}},l=L(!1),r=L(!1);U(()=>{o.colors.fg=v(r)?"red":"#fff",o.colors.bg=v(r)?"green":"#000",c()});let f="colour blind mode";function c(){if(e!==void 0){e.fillRect(s.from(0,0),e.size,o.colors.bg);for(let d=0;d<f.length;d++)f.charAt(d)!==" "&&e.drawChar(s.from(13+5*d,1),f.charAt(d),o.colors.fg);e.drawBitmap(s.from(4,1),j[v(r)?1:0],o.colors.fg)}}T(()=>{const d=5*f.length+9+4;e=new x(n,s.from(0,0),s.from(d,7),o.pixelScale),n.width=d*o.pixelScale,n.height=8*o.pixelScale,c();const m=new Z(t,o);m.run();let P=R=>{R.key==="m"&&E(l,!v(l))};return document.addEventListener("keypress",P),()=>{m.destroy(),document.removeEventListener("keypress",P)}});var a=Q();let u;var p=A(a),y=A(p);C(y,d=>t=d,()=>t);var g=q(y,2);let w;g.__click=[K,r],C(g,d=>n=d,()=>n),S(p),S(a),N((d,m)=>{u=z(a,1,"svelte-be2ncb",null,u,d),w=z(g,1,"config svelte-be2ncb",null,w,m)},[()=>({"color-blind-mode":v(r)}),()=>({show:v(l)})]),Y(h,a),G()}F(["click"]);export{ni as component};
