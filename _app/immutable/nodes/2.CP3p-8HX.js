import"../chunks/DsnmJJEf.js";import{d as D,o as I}from"../chunks/C2hLB0R9.js";import{A,D as U,J as _,a6 as d,a0 as q,as as E,aB as S,ac as B,a1 as N,$ as G,G as Y,aa as M,ab as z}from"../chunks/BmeX_oOh.js";import{b as L}from"../chunks/BIYonOwp.js";const b=[...` 	
\r\fÂ \v\uFEFF`];function O(h,e,t){var i=h==null?"":""+h;if(t){for(var n in t)if(t[n])i=i?i+" "+n:n;else if(i.length)for(var o=n.length,l=0;(l=i.indexOf(n,l))>=0;){var r=l+o;(l===0||b.includes(i[l-1]))&&(r===i.length||b.includes(i[r]))?i=(l===0?"":i.substring(0,l))+i.substring(r+1):l=r}}return i===""?null:i}function C(h,e,t,i,n,o){var l=h.__className;if(A||l!==t||l===void 0){var r=O(t,i,o);(!A||r!==h.getAttribute("class"))&&(r==null?h.removeAttribute("class"):h.className=r),h.__className=t}else if(o&&n!==o)for(var f in o){var a=!!o[f];(n==null||a!==!!n[f])&&h.classList.toggle(f,a)}return o}class s{x;y;constructor(e,t){this.x=e,this.y=t}static from(e,t){return new s(e,t)}static fromPolar(e,t){return new s(e*Math.cos(t),e*Math.sin(t))}static add(...e){return new s(e.reduce((t,i)=>t+i.x,0),e.reduce((t,i)=>t+i.y,0))}theta(){return Math.atan2(this.y,this.x)}r(){return Math.hypot(this.x,this.y)}negate(){return new s(-this.x,-this.y)}scale(e){return new s(this.x*e,this.y*e)}}const X={STYLISED:[[[0,0,0],[0,1,1],[1,0,1],[1,0,1],[1,1,0]],[[0,1,0],[1,1,0],[0,1,0],[0,1,0],[0,1,1]],[[0,1,0],[0,0,1],[0,1,0],[1,0,0],[1,1,1]],[[1,1,0],[0,1,0],[0,1,1],[0,0,1],[1,1,0]],[[1,0,0],[1,0,0],[1,0,0],[1,1,1],[0,0,1]],[[1,1,0],[1,0,0],[1,1,1],[0,0,1],[1,1,0]],[[0,1,0],[1,0,0],[1,1,1],[1,0,1],[0,1,0]],[[1,1,1],[0,0,1],[0,1,0],[1,0,0],[1,0,0]],[[0,1,0],[1,0,1],[0,1,0],[1,0,1],[1,1,0]],[[0,1,0],[1,0,1],[1,1,1],[0,0,1],[0,1,1]]]},$={DEFAULT:[[[0,0,0,0],[0,1,1,1],[1,0,0,1],[1,0,1,1],[0,1,0,1]],[[1,0,0,0],[1,1,1,0],[1,0,0,1],[1,0,0,1],[1,1,1,0]],[[0,0,0,0],[0,1,1,1],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[[0,0,0,1],[0,1,1,1],[1,0,0,1],[1,0,0,1],[0,1,1,1]],[[0,0,0,0],[0,1,1,0],[1,1,1,1],[1,0,0,0],[0,1,1,1]],[],[],[],[[1,0,0,0],[0,0,0,0],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[],[],[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0],[0,1,1,1]],[[0,0,0,0],[1,1,1,1],[1,0,1,1],[1,0,0,1],[1,0,0,1]],[[0,0,0,0],[1,0,1,1],[1,1,0,1],[1,0,0,1],[1,0,0,1]],[[0,0,0,0],[0,1,1,0],[1,0,0,1],[1,0,0,1],[0,1,1,0]],[],[],[[0,0,0,0],[1,0,1,1],[1,1,0,1],[1,0,0,0],[1,0,0,0]],[],[],[[0,0,0,0],[1,0,0,1],[1,0,0,1],[1,0,1,1],[0,1,0,1]],[],[],[],[],[]]};class m{canvas;ctx;originRawPixels;size;pixelScale;mousePos_=null;lastMousePos_=null;updateMousePosListener=e=>{let t=this.canvas.getBoundingClientRect();this.mousePos_=this.lastMousePos_=s.add(s.add(s.from(e.clientX,e.clientY),this.originRawPixels.negate(),s.from(-t.x,-t.y)).scale(1/this.pixelScale),s.from(-.5,-.5))};clearMousePosListener=e=>this.mousePos_=null;constructor(e,t,i,n){this.canvas=e;const o=this.canvas.getContext("2d");if(o===null)throw new Error("Could not get 2D canvas context");this.ctx=o,this.canvas.addEventListener("mouseenter",this.updateMousePosListener),this.canvas.addEventListener("mouseleave",this.clearMousePosListener),this.canvas.addEventListener("mousemove",this.updateMousePosListener),this.originRawPixels=t,this.size=i,this.pixelScale=n}destroy(){this.canvas.removeEventListener("mouseenter",this.updateMousePosListener),this.canvas.removeEventListener("mouseleave",this.clearMousePosListener),this.canvas.removeEventListener("mousemove",this.updateMousePosListener)}clear(e){this.ctx.fillStyle=e,this.ctx.fillRect(this.originRawPixels.x,this.originRawPixels.y,this.size.x*this.pixelScale,this.size.y*this.pixelScale)}drawPixel(e,t){this.ctx.fillStyle=t,!(e.x<0||e.x>=this.size.x||e.y<0||e.y>=this.size.y)&&this.ctx.fillRect(this.originRawPixels.x+Math.floor(e.x)*this.pixelScale,this.originRawPixels.y+Math.floor(e.y)*this.pixelScale,this.pixelScale,this.pixelScale)}drawLineLow(e,t,i,n,o){let l=i-e,r=n-t,f=1;r<0&&(r=-r,f=-1);let a=2*r-l,c=t;for(let y=e;y<=i;y++)this.drawPixel(s.from(y,c),o),a>0?(c+=f,a+=2*(r-l)):a+=2*r}drawLineHigh(e,t,i,n,o){let l=i-e,r=n-t,f=1;l<0&&(l=-l,f=-1);let a=2*l-r,c=e;for(let y=t;y<=n;y++)this.drawPixel(s.from(c,y),o),a>0?(c+=f,a+=2*(l-r)):a+=2*l}drawLine(e,t,i){Math.abs(t.y-e.y)<Math.abs(t.x-e.x)?e.x>t.x?this.drawLineLow(t.x,t.y,e.x,e.y,i):this.drawLineLow(e.x,e.y,t.x,t.y,i):e.y>t.y?this.drawLineHigh(t.x,t.y,e.x,e.y,i):this.drawLineHigh(e.x,e.y,t.x,t.y,i)}fillRect(e,t,i){this.ctx.fillStyle=i;const n=s.add(e.scale(this.pixelScale),this.originRawPixels),o=t.scale(this.pixelScale);this.ctx.fillRect(n.x,n.y,o.x,o.y)}fillCircle(e,t,i){let n=Math.floor(e.x-t),o=Math.ceil(e.x+t),l=Math.floor(e.y-t),r=Math.ceil(e.y+t);for(let f=n;f<=o;f+=1)for(let a=l;a<=r;a+=1){let c=new s(f,a);s.add(e,c.negate()).r()<=t&&this.drawPixel(c,i)}}drawBitmap(e,t,i){t.forEach((n,o)=>{n.forEach((l,r)=>{l===1&&this.drawPixel(s.add(e,s.from(r,o)),i)})})}drawNumber(e,t,i){let n=X.STYLISED,o=t.charCodeAt(0)-48;this.drawBitmap(e,n[o],i)}drawChar(e,t,i){let n=$.DEFAULT,o=t.charCodeAt(0)-97;this.drawBitmap(e,n[o],i)}mousePos(){return this.mousePos_}lastMousePos(){return this.lastMousePos_}subCanvas(e,t){return new m(this.canvas,s.add(this.originRawPixels,e.scale(this.pixelScale)),t,this.pixelScale)}}class k{position;velocity;invulnerabilityUntil=0;constructor(e){this.position=e,this.velocity=new s(0,0)}invulnerable(e){return this.invulnerabilityUntil>e}}function H(h){return new s(Math.round(h.x),Math.round(h.y))}class W{size;renderOffset;position;velocity;constructor(e,t,i){this.size=e,this.position=t,this.renderOffset=s.add(this.position,H(this.position).negate()),this.velocity=i}renderPosition(){return s.add(H(this.position),this.renderOffset)}}function J(h){return new Promise(e=>setTimeout(e,h))}class Z{canvas;config;pixelCanvas;instance=null;constructor(e,t){this.canvas=e;let i=F.computeCanvasSize(t);const n=i.scale(t.pixelScale);e.width=n.x,e.height=n.y,this.config=t,this.pixelCanvas=new m(this.canvas,new s(0,0),i,this.config.pixelScale)}destroy(){this.instance!==null&&(this.instance.destroy(),this.instance=null),this.pixelCanvas.destroy()}run(){this.instance===null&&(this.instance=new F(this.pixelCanvas,this.config),this.instance.run())}}const R=9;class F{config;canvas;playAreaCanvas;player;score=0;asteroids=[];nextAsteroidIn=0;playerHitAt=null;playerSpawnAt=0;running=!1;constructor(e,t){this.config=t,this.canvas=e,this.playAreaCanvas=e.subCanvas(new s(1,1),t.playAreaSize),this.player=new k(t.playAreaSize.scale(.5))}static computeCanvasSize(e){return s.from(e.playAreaSize.x+2,e.playAreaSize.y+2+R)}destroy(){this.running=!1,this.playAreaCanvas.destroy(),this.canvas.destroy()}async run(){this.running=!0;let e=new Date().getTime(),t=0;for(;this.running;){const i=(new Date().getTime()-e)/1e3,n=i-t;t=i,this.gameLoop(i,n),await J(1e3/this.config.fps)}}gameLoop(e,t){let i=this.player,n=this.config.playAreaSize,o=this.config.colors.fg,l=this.config.colors.bg;if(this.playerHitAt===null){let a=this.playAreaCanvas.lastMousePos();if(a!==null){let c=s.add(a,i.position.negate());i.velocity=s.add(i.velocity,c.scale(this.config.mousePull))}i.position=s.add(i.position,i.velocity.scale(t)),i.position.x<0?(i.position=new s(0,i.position.y),i.velocity.x<0&&(i.velocity=new s(i.velocity.x*-.5,i.velocity.y))):i.position.x>=n.x&&(i.position=new s(n.x,i.position.y),i.velocity.x>0&&(i.velocity=new s(i.velocity.x*-.5,i.velocity.y))),i.position.y<0?(i.position=new s(i.position.x,0),i.velocity.y<0&&(i.velocity=new s(i.velocity.x,i.velocity.y*-.5))):i.position.y>=n.y&&(i.position=new s(i.position.x,n.y),i.velocity.y>0&&(i.velocity=new s(i.velocity.x,i.velocity.y*-.5)))}else this.playerHitAt+this.config.playerHit.respawnTime<e&&(i.position=this.playAreaCanvas.lastMousePos()??this.playAreaCanvas.size.scale(.5),i.velocity=s.from(0,0),this.playerHitAt=null,this.playerSpawnAt=e,this.asteroids=[]);for(this.nextAsteroidIn-=t;this.nextAsteroidIn<=0;){const a=Math.random()*Math.PI*2,c=s.add(s.fromPolar(Math.max(n.x,n.y),a),n.scale(.5)),y=s.fromPolar(this.config.asteroid.velMin+Math.random()*(this.config.asteroid.velMax-this.config.asteroid.velMin),a+.75*Math.PI+.5*Math.PI*Math.random());this.asteroids.push(new W(this.config.asteroid.sizeMin+Math.random()*(this.config.asteroid.sizeMax-this.config.asteroid.sizeMin),c,y)),this.nextAsteroidIn+=this.config.asteroid.spawnFreq}for(const a of this.asteroids)a.position=s.add(a.position,a.velocity.scale(t));if(this.asteroids=this.asteroids.filter(a=>a.position.x<-a.size&&a.velocity.x<0||a.position.x>=n.x+a.size&&a.velocity.x>0||a.position.y<-a.size&&a.velocity.y<0?!1:!(a.position.y>=n.y+a.size&&a.velocity.y>0)),!i.invulnerable(e))for(const a of this.asteroids){if(!(i.position.x>a.position.x-.5*a.size&&i.position.x<a.position.x+.5*a.size&&i.position.y>a.position.y-.5*a.size&&i.position.y<a.position.y+.5*a.size))continue;s.add(i.position,a.position.negate()).r()<.5*a.size&&(this.playerHitAt=e,i.invulnerabilityUntil=e+this.config.playerHit.respawnTime+this.config.playerHit.invulnerabilityDuration)}this.playerHitAt!==null?this.score=this.playerHitAt-this.playerSpawnAt:this.score=e-this.playerSpawnAt;const r=()=>{if(this.playerHitAt!==null){const a=e-this.playerHitAt;if(a<this.config.playerHit.flashDuration&&a%this.config.playerHit.flashFreq<.5*this.config.playerHit.flashFreq)return!0}return!1};this.playAreaCanvas.clear(r()?o:l);for(const a of this.asteroids)this.playAreaCanvas.fillCircle(a.renderPosition(),a.size/2,o);if(!!!(this.playerHitAt!==null||i.invulnerable(e)&&(i.invulnerabilityUntil-e)%this.config.playerHit.invulnerabilityFlashFreq<.5*this.config.playerHit.invulnerabilityFlashFreq)){const a=s.from(i.position.x==this.config.playAreaSize.x?this.config.playAreaSize.x-1:i.position.x,i.position.y==this.config.playAreaSize.y?this.config.playAreaSize.y-1:i.position.y);this.playAreaCanvas.drawPixel(a,o)}this.paintHUD()}paintHUD(){let e=this.config.colors.fg,t=this.config.colors.bg,i=this.config.playAreaSize.y+1,n=this.config.playAreaSize.x+1;this.canvas.drawLine(s.from(0,0),s.from(0,i),e),this.canvas.drawLine(s.from(0,i),s.from(n,i),e),this.canvas.drawLine(s.from(0,0),s.from(n,0),e),this.canvas.drawLine(s.from(n,0),s.from(n,i),e);let o=s.from(0,i+1),l=s.from(n,R);const r=e,f=t;this.canvas.fillRect(o,l,f);const a=7,c=s.add(o,s.from(l.x-4*a-3,2)),y=Math.round(this.score*10).toString().padStart(a-1,"0");let v=!0;for(let p=0;p<a-1;p++)v&&p<a-3&&y.charAt(p)==="0"||(v=!1,p===a-2?(this.canvas.drawPixel(s.add(c,s.from(4*p,4)),r),this.canvas.drawNumber(s.add(c,s.from(4*p+2,0)),y.charAt(p),r)):this.canvas.drawNumber(s.add(c,s.from(4*p,0)),y.charAt(p),r))}}const j=[[[1,1,0,0,1],[0,0,0,0,1],[0,0,0,0,0],[1,0,0,0,0],[1,0,0,1,1]],[[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0]]];var K=(h,e)=>E(e,!d(e)),Q=q('<main><div class="wrapper svelte-be2ncb"><canvas></canvas> <canvas></canvas></div></main>');function si(h,e){U(e,!0);let t,i,n,o={fps:30,playAreaSize:new s(100,100),pixelScale:8,mousePull:.1,asteroid:{spawnFreq:.3,sizeMin:8,sizeMax:25,velMin:5,velMax:20},playerHit:{flashFreq:.1,flashDuration:.5,respawnTime:2,invulnerabilityDuration:2,invulnerabilityFlashFreq:.2},colors:{bg:"#000",fg:"#fff"}},l=S(!1),r=S(!1);_(()=>{o.colors.fg=d(r)?"red":"#fff",o.colors.bg=d(r)?"green":"#000",a()});let f="colour blind mode";function a(){if(n!==void 0){n.fillRect(s.from(0,0),n.size,o.colors.bg);for(let u=0;u<f.length;u++)f.charAt(u)!==" "&&n.drawChar(s.from(13+5*u,1),f.charAt(u),o.colors.fg);n.drawBitmap(s.from(4,1),j[d(r)?1:0],o.colors.fg)}}I(()=>{const u=5*f.length+9+4;n=new m(i,s.from(0,0),s.from(u,7),o.pixelScale),i.width=u*o.pixelScale,i.height=8*o.pixelScale,a();const x=new Z(t,o);x.run();let P=T=>{T.key==="m"&&E(l,!d(l))};return document.addEventListener("keypress",P),()=>{x.destroy(),document.removeEventListener("keypress",P)}});var c=Q();let y;var v=M(c),p=M(v);L(p,u=>t=u,()=>t);var g=B(p,2);let w;g.__click=[K,r],L(g,u=>i=u,()=>i),z(v),z(c),N((u,x)=>{y=C(c,1,"svelte-be2ncb",null,y,u),w=C(g,1,"config svelte-be2ncb",null,w,x)},[()=>({"color-blind-mode":d(r)}),()=>({show:d(l)})]),G(h,c),Y()}D(["click"]);export{si as component};
